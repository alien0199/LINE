<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Weather In Buri üå§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;600&display=swap" rel="stylesheet">
    <style>
        /* ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏™‡∏î‡πÉ‡∏™ ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• (Auto Weather In Buri Theme) */
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 15px;
            color: #444;
        }

        .card {
            background: rgba(255, 255, 255, 0.90);
            backdrop-filter: blur(10px);
            border-radius: 35px;
            padding: 30px 20px;
            width: 100%;
            max-width: 380px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 2px solid #fff;
        }

        .location-badge {
            background: #ff9a9e;
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.85em;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4);
        }

        h1 { margin: 0; color: #555; font-size: 1.6em; font-weight: 600; }
        .timestamp { font-size: 0.8em; color: #888; margin-bottom: 25px; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        .data-box {
            background: #ffffff;
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s;
        }
        .data-box:active { transform: scale(0.98); }

        .weather-icon img { width: 80px; height: 80px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        
        .temp-big { font-size: 2.8em; font-weight: bold; color: #4facfe; line-height: 1; }
        .weather-desc { font-size: 1em; color: #666; margin-top: 5px; }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏ù‡∏∏‡πà‡∏ô PM2.5 */
        .pm-label { font-size: 0.9em; color: #888; text-align: left; }
        .pm-value { font-size: 2.2em; font-weight: bold; color: #333; }
        .pm-unit { font-size: 0.5em; color: #999; font-weight: normal; }
        .pm-status { font-size: 0.9em; font-weight: 600; margin-top: 5px; }

        /* ‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏∏‡πà‡∏ô */
        .status-good { color: #00b894; }      /* ‡∏î‡∏µ‡∏°‡∏≤‡∏Å */
        .status-moderate { color: #fdcb6e; }  /* ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á */
        .status-bad { color: #ff7675; }       /* ‡πÅ‡∏¢‡πà */
        .status-vbad { color: #d63031; }      /* ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ */

        /* ‡∏õ‡∏∏‡πà‡∏° Refresh */
        .btn-refresh {
            background: linear-gradient(45deg, #a18cd1, #fbc2eb);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 50px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 5px 20px rgba(161, 140, 209, 0.4);
            font-family: 'Kanit', sans-serif;
            font-weight: 500;
        }
        .btn-refresh:hover { opacity: 0.9; }
    
        /* ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏Å‡∏±‡∏î */
        .address {
            font-size: 0.85em;
            color: #666;
            margin-top: 6px;
            line-height: 1.35;
        }
        .coords {
            font-size: 0.78em;
            color: #888;
            margin-top: 6px;
        }
        .loc-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 12px 0 6px 0;
            flex-wrap: wrap;
        }
        .btn-small {
            padding: 10px 18px;
            border-radius: 50px;
            font-size: 0.95em;
        }
        .btn-secondary {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
            box-shadow: 0 5px 20px rgba(67, 233, 123, 0.35);
        }
        .btn-ghost {
            background: rgba(255,255,255,0.6);
            color: #555;
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.06);
        }
        .map-link {
            display: inline-block;
            margin-top: 4px;
            font-size: 0.85em;
            color: #6c5ce7;
            text-decoration: none;
            font-weight: 500;
        }
        .map-link:hover { text-decoration: underline; }


        /* ‡∏õ‡∏£‡∏±‡∏ö badge ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß */
        .location-badge { max-width: 100%; white-space: normal; line-height: 1.25; }

</style>
</head>
<body>

    <div class="card">
        <div class="location-badge" id="loc-badge">üìç ‡∏´‡∏°‡∏π‡πà 6 ‡∏ï.‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ</div>
        <h1>‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h1>
        <div class="address" id="loc-address">‡∏´‡∏°‡∏π‡πà 6 ‡∏ï‡∏≥‡∏ö‡∏•‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ 16110</div>
        <div class="coords" id="loc-coords">‡∏û‡∏¥‡∏Å‡∏±‡∏î: --</div>
        <div class="timestamp" id="last-update">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        <div class="loc-actions">
            <button class="btn-refresh btn-small btn-secondary" onclick="useGPS()">üì° ‡πÉ‡∏ä‡πâ GPS</button>
            <button class="btn-refresh btn-small btn-ghost" onclick="resetLocation()">‚Ü©Ô∏è ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
        </div>
        <a class="map-link" id="map-link" href="#" target="_blank" rel="noopener">üó∫Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>

        <div class="data-box">
            <div style="text-align: left;">
                <div class="temp-big" id="temp">--¬∞</div>
                <div class="weather-desc" id="weather-desc">‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</div>
                <div style="font-size: 0.8em; color:#aaa; margin-top:5px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <span id="humidity">--</span>%</div>
            </div>
            <div class="weather-icon" id="weather-icon"></div>
        </div>

        <div class="data-box" style="display: block; text-align: center;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span class="pm-label">‡∏ù‡∏∏‡πà‡∏ô PM 2.5</span>
                <span style="font-size: 1.5em;">üò∑</span>
            </div>
            <div class="pm-value" id="pm-val">-- <span class="pm-unit">Œºg/m¬≥</span></div>
            <div class="pm-status" id="pm-status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
        </div>

        <button class="btn-refresh" onclick="fetchData()">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
    </div>

    <script>
        // --- üîí ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Configuration) ---
        // ‡∏û‡∏¥‡∏Å‡∏±‡∏î "‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô" ‡∏Ç‡∏≠‡∏á‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á/‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠)
        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏´‡∏°‡∏π‡πà 6 ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠‡∏¢‚Äî‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ "‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î" ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° üì° ‡πÉ‡∏ä‡πâ GPS
        const DEFAULT_LAT = 15.012146709989606;
        const DEFAULT_LON = 100.33121519335744;

        let LAT = DEFAULT_LAT;
        let LON = DEFAULT_LON;

        const LOCATION_LABEL = '‡∏´‡∏°‡∏π‡πà 6 ‡∏ï.‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ';
        const LOCATION_FULL = '‡∏´‡∏°‡∏π‡πà 6 ‡∏ï‡∏≥‡∏ö‡∏•‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ 16110';
        const API_KEY = '8f195d69782e5f85fedd737fb5c1bbe5'; // Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

        function mapUrl(lat, lon) {
            return `https://www.google.com/maps?q=${lat},${lon}`;
        }

        function updateLocationUI(extra = '') {
            document.getElementById('loc-badge').innerText = `üìç ${LOCATION_LABEL}`;
            document.getElementById('loc-address').innerText = LOCATION_FULL;
            document.getElementById('loc-coords').innerText = `‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${LAT.toFixed(5)}, ${LON.toFixed(5)}${extra ? ' ‚Ä¢ ' + extra : ''}`;
            const link = document.getElementById('map-link');
            link.href = mapUrl(LAT, LON);
        }

        function setLocation(lat, lon, sourceText = '') {
            LAT = lat;
            LON = lon;
            // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
            localStorage.setItem('customLat', String(LAT));
            localStorage.setItem('customLon', String(LON));
            updateLocationUI(sourceText);
        }

        function resetLocation() {
            localStorage.removeItem('customLat');
            localStorage.removeItem('customLon');
            LAT = DEFAULT_LAT;
            LON = DEFAULT_LON;
            updateLocationUI('‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô');
            fetchData();
        }

        function useGPS() {
            if (!navigator.geolocation) {
                alert('‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå/‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS');
                return;
            }
            document.getElementById('last-update').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á GPS...';
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;
                    const acc = pos.coords.accuracy ? Math.round(pos.coords.accuracy) : null;
                    setLocation(lat, lon, acc ? `GPS ¬±${acc}m` : 'GPS');
                    fetchData();
                },
                (err) => {
                    console.error('GPS Error:', err);
                    alert('‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏•‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Location ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà)');
                    updateLocationUI('‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 12000,
                    maximumAge: 60000
                }
            );
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const savedLat = parseFloat(localStorage.getItem('customLat'));
        const savedLon = parseFloat(localStorage.getItem('customLon'));
        if (!Number.isNaN(savedLat) && !Number.isNaN(savedLon)) {
            LAT = savedLat;
            LON = savedLon;
        }
        updateLocationUI(LAT === DEFAULT_LAT && LON === DEFAULT_LON ? '‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô' : '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ');


        async function fetchData() {
            const updateTime = new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('last-update').innerText = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${updateTime} ‡∏ô.`;
            
            // 1. ‡∏î‡∏∂‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏® (Current Weather)
            try {
                const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&appid=${API_KEY}&units=metric&lang=th`);
                const wData = await weatherRes.json();
                
                document.getElementById('temp').innerText = Math.round(wData.main.temp) + "¬∞";
                document.getElementById('weather-desc').innerText = wData.weather[0].description;
                document.getElementById('humidity').innerText = wData.main.humidity;
                
                const iconCode = wData.weather[0].icon;
                document.getElementById('weather-icon').innerHTML = `<img src="https://openweathermap.org/img/wn/${iconCode}@2x.png" alt="weather">`;
            } catch (error) {
                console.error("Weather Error:", error);
            }

            // 2. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô PM2.5 (Air Pollution API)
            try {
                const airRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${LAT}&lon=${LON}&appid=${API_KEY}`);
                const airData = await airRes.json();
                
                // OpenWeatherMap ‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤ pm2_5 ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ Œºg/m3 ‡∏ï‡∏£‡∏á‡πÜ
                const pm25 = airData.list[0].components.pm2_5;
                const pmElement = document.getElementById('pm-val');
                const statusElement = document.getElementById('pm-status');

                pmElement.innerHTML = `${pm25.toFixed(1)} <span class="pm-unit">Œºg/m¬≥</span>`;

                // ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢)
                statusElement.className = 'pm-status'; // Reset class
                if (pm25 <= 25) {
                    statusElement.innerText = "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ‡∏°‡∏≤‡∏Å üíö";
                    statusElement.classList.add('status-good');
                } else if (pm25 <= 37.5) {
                    statusElement.innerText = "‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ üíõ";
                    statusElement.classList.add('status-moderate');
                } else if (pm25 <= 75) {
                    statusElement.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö üß°";
                    statusElement.classList.add('status-bad');
                } else {
                    statusElement.innerText = "‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ üî¥";
                    statusElement.classList.add('status-vbad');
                }

            } catch (error) {
                console.error("PM2.5 Error:", error);
                document.getElementById('pm-status').innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏∏‡πà‡∏ô";
            }
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
        fetchData();
    </script>
</body>
</html>
