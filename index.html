<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Weather In Buri üå§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- CSS Design: Pastel & Modern UI --- */
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
            color: #4a4a4a;
        }

        .bg-gradient {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 10% 20%, rgb(255, 222, 225) 0%, rgb(214, 252, 255) 90%);
            z-index: -1;
            opacity: 0.7;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 40px;
            padding: 30px 25px;
            width: 100%;
            max-width: 380px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            border: 2px solid #fff;
        }

        /* Location Badge */
        .badge-loc {
            background: #ff9a9e;
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4);
            margin-bottom: 15px;
            font-weight: 500;
        }

        h1 { margin: 5px 0; font-size: 1.6rem; font-weight: 600; color: #555; }
        .sub-text { font-size: 0.8rem; color: #999; margin-bottom: 20px; }

        /* ‡∏õ‡∏∏‡πà‡∏° Action */
        .btn-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; }
        .btn {
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Kanit';
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        .btn-gps { background: #4ADE80; color: white; box-shadow: 0 4px 10px rgba(74, 222, 128, 0.4); }
        .btn-reset { background: #f1f5f9; color: #64748B; }
        .btn:active { transform: scale(0.95); }

        /* Weather Box (‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡πÉ‡∏´‡∏ç‡πà) */
        .weather-box {
            background: linear-gradient(180deg, #E0F2FE 0%, #F0F9FF 100%);
            border-radius: 30px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        .temp-huge {
            font-size: 5rem;
            font-weight: 800;
            line-height: 1;
            color: #3B82F6;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .degree { font-size: 2.5rem; margin-top: 10px; color: #60a5fa; }
        .weather-status { font-size: 1.2rem; font-weight: 600; color: #475569; margin-top: 5px; display: flex; justify-content: center; align-items: center; gap: 8px;}
        .humidity { font-size: 0.85rem; color: #94A3B8; margin-top: 5px; }

        /* Info Cards (PM2.5 & Water) */
        .info-card {
            background: white;
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            text-align: left;
            position: relative;
        }
        .card-label { font-size: 0.9rem; color: #94A3B8; font-weight: 500; display: flex; justify-content: space-between;}
        .card-value { font-size: 2.5rem; font-weight: 800; color: #334155; margin-top: 5px; display: flex; align-items: baseline; gap: 5px; line-height: 1.1;}
        .card-unit { font-size: 0.4em; color: #94A3B8; font-weight: 600; }
        .card-sub { font-size: 0.85rem; color: #64748B; margin-top: 8px; background: #F1F5F9; padding: 6px 12px; border-radius: 12px; display: inline-block;}

        /* Status Colors */
        .st-good { color: #10b981; background: #d1fae5; }
        .st-warn { color: #f59e0b; background: #fef3c7; }
        .st-danger { color: #ef4444; background: #fee2e2; }
        
        /* Water Specific */
        .water-safe { color: #10b981; }
        .water-high { color: #ef4444; }

        /* Animation */
        .loading { animation: pulse 1.5s infinite; opacity: 0.6; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        
        .error-msg { font-size: 0.7em; color: #ef4444; margin-top:5px; }
    </style>
</head>
<body>

    <div class="bg-gradient"></div>

    <div class="card">
        <div class="badge-loc" id="location-badge">üìç ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)</div>
        
        <h1>‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h1>
        <div class="sub-text" id="last-update">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>

        <div class="btn-group">
            <button class="btn btn-gps" onclick="getLocation()">üõ∞Ô∏è ‡πÉ‡∏ä‡πâ GPS</button>
            <button class="btn btn-reset" onclick="resetLocation()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>

        <div class="weather-box">
            <div id="temp-val" class="temp-huge loading">--<span class="degree">¬∞</span></div>
            <div id="weather-txt" class="weather-status"><span>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span></div>
            <div id="humid-val" class="humidity">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: --%</div>
        </div>

        <div class="info-card">
            <div class="card-label">‡∏ù‡∏∏‡πà‡∏ô PM 2.5 <span id="pm-emoji">üò∑</span></div>
            <div class="card-value" id="pm-val"><span class="loading" style="font-size:0.6em;">Checking...</span></div>
            <div class="card-sub" id="pm-desc" style="background:none;">‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</div>
        </div>

        <div class="info-card">
            <div class="card-label">
                <span>üåä ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ (‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ)</span>
                <span style="font-size:0.75em; color:#FF8BA7; background:#fff0f3; padding:2px 8px; border-radius:10px;">‡∏ï‡∏•‡∏¥‡πà‡∏á 15.10 ‡∏°.</span>
            </div>
            <div class="card-value" id="water-val"><span class="loading" style="font-size:0.6em;">Connecting...</span></div>
            <div class="card-sub" id="water-desc" style="background:none;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏à‡∏≤‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏°‡∏ä‡∏•‡∏Ø...</div>
        </div>

        <div class="info-card" style="background: #F0FDFA;">
            <div class="card-label">üíß ‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤ (C.13)</div>
            <div class="card-value" id="dam-val" style="color: #0891b2;"><span class="loading" style="font-size:0.6em;">...</span></div>
            <div class="card-sub" id="dam-desc" style="background:none;">‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥</div>
        </div>

    </div>

    <script>
        // --- Configuration ---
        const DEFAULT_LAT = 15.0121; // ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ
        const DEFAULT_LON = 100.3312;
        const BANK_LEVEL = 15.10; // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏•‡∏¥‡πà‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ
        
        let lat = DEFAULT_LAT;
        let lon = DEFAULT_LON;

        // --- Weather Codes ---
        const weatherCodes = {
            0: "‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡πÅ‡∏à‡πà‡∏°‡πÉ‡∏™ ‚òÄÔ∏è", 1: "‡πÄ‡∏°‡∏Ü‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ üå§Ô∏è", 2: "‡πÄ‡∏°‡∏Ü‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‚õÖ", 3: "‡πÄ‡∏°‡∏Ü‡∏°‡∏≤‡∏Å ‚òÅÔ∏è",
            45: "‡∏°‡∏µ‡∏´‡∏°‡∏≠‡∏Å üå´Ô∏è", 51: "‡∏ù‡∏ô‡∏õ‡∏£‡∏≠‡∏¢‡πÜ üåßÔ∏è", 53: "‡∏ù‡∏ô‡∏ï‡∏Å‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üåßÔ∏è", 
            55: "‡∏ù‡∏ô‡∏ï‡∏Å‡∏´‡∏ô‡∏±‡∏Å üåßÔ∏è", 61: "‡∏ù‡∏ô‡∏ï‡∏Å‡πÄ‡∏ö‡∏≤ üåßÔ∏è", 63: "‡∏ù‡∏ô‡∏ï‡∏Å‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üåßÔ∏è", 
            65: "‡∏ù‡∏ô‡∏ï‡∏Å‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏Å ‚õàÔ∏è", 80: "‡∏ù‡∏ô‡∏ï‡∏Å‡∏õ‡∏£‡∏≠‡∏¢‡πÜ üå¶Ô∏è", 95: "‡∏û‡∏≤‡∏¢‡∏∏‡∏ù‡∏ô‡∏ü‡πâ‡∏≤‡∏Ñ‡∏∞‡∏ô‡∏≠‡∏á ‚ö°"
        };

        window.onload = function() {
            if(localStorage.getItem('userLat')) {
                lat = localStorage.getItem('userLat');
                lon = localStorage.getItem('userLon');
                document.getElementById('location-badge').innerText = "üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
            }
            fetchAllData();
        };

        async function fetchAllData() {
            const timeStr = new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'});
            document.getElementById('last-update').innerText = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ${timeStr} ‡∏ô.`;
            
            fetchWeatherAndPM();
            fetchWaterDataWithRetry(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Retry
        }

        // 1. ‡∏î‡∏∂‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏® & PM2.5 (‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å null)
        async function fetchWeatherAndPM() {
            try {
                // ‡πÉ‡∏ä‡πâ API ‡πÅ‡∏¢‡∏Å 2 ‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
                // 1.1 ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code&timezone=Asia%2FBangkok`);
                const wData = await wRes.json();
                
                if (wData.current) {
                    const temp = Math.round(wData.current.temperature_2m);
                    document.getElementById('temp-val').innerHTML = `${temp}<span class="degree">¬∞</span>`;
                    document.getElementById('temp-val').classList.remove('loading');
                    
                    const code = wData.current.weather_code;
                    document.getElementById('weather-txt').innerHTML = weatherCodes[code] || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                    document.getElementById('humid-val').innerText = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${wData.current.relative_humidity_2m}%`;
                }

                // 1.2 PM2.5 (‡πÉ‡∏ä‡πâ Air Quality API ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ hourly ‡πÅ‡∏•‡πâ‡∏ß)
                const aRes = await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&current=pm2_5&timezone=Asia%2FBangkok`);
                const aData = await aRes.json();
                
                if (aData.current && aData.current.pm2_5 != null) {
                    const pm25 = Math.round(aData.current.pm2_5);
                    document.getElementById('pm-val').innerHTML = `${pm25} <span class="card-unit">Œºg/m¬≥</span>`;
                    
                    const pmDesc = document.getElementById('pm-desc');
                    const pmEmoji = document.getElementById('pm-emoji');
                    
                    pmDesc.className = "card-sub"; // Reset class
                    if(pm25 <= 25) { 
                        pmDesc.innerText = "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ‡∏°‡∏≤‡∏Å üçÉ"; 
                        pmDesc.classList.add('st-good');
                        pmEmoji.innerText = "üòä"; 
                    } else if(pm25 <= 50) { 
                        pmDesc.innerText = "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á"; 
                        pmDesc.classList.add('st-warn');
                        pmEmoji.innerText = "üòê"; 
                    } else { 
                        pmDesc.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö"; 
                        pmDesc.classList.add('st-danger');
                        pmEmoji.innerText = "üò∑"; 
                    }
                } else {
                    document.getElementById('pm-val').innerText = "N/A";
                }

            } catch (e) {
                console.error("Weather/PM Error", e);
                document.getElementById('temp-val').innerText = "--";
            }
        }

        // 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏ö‡∏ö‡∏°‡∏µ "‡∏Å‡πä‡∏≠‡∏Å‡∏™‡∏≥‡∏£‡∏≠‡∏á" (Proxy Rotation)
        async function fetchWaterDataWithRetry() {
            // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Proxy ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
            const proxies = [
                (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`, // ‡∏Å‡πä‡∏≠‡∏Å 1 (‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏™‡∏∏‡∏î)
                (url) => `https://corsproxy.io/?${encodeURIComponent(url)}`,             // ‡∏Å‡πä‡∏≠‡∏Å 2
                (url) => `https://thingproxy.freeboard.io/fetch/${url}`                  // ‡∏Å‡πä‡∏≠‡∏Å 3
            ];

            const urlInburi = "https://api-v3.thaiwater.net/api/v1/thaiwater30/public/waterlevel?province_code=17"; // ‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ
            const urlDam = "https://api-v3.thaiwater.net/api/v1/thaiwater30/public/waterlevel?province_code=18"; // ‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó

            let inburiSuccess = false;
            let damSuccess = false;

            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏•‡∏≠‡∏á Proxy ‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß
            for (let i = 0; i < proxies.length; i++) {
                const makeUrl = proxies[i];
                console.log(`Trying Proxy #${i+1}...`);

                // A. ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ
                if (!inburiSuccess) {
                    try {
                        const res = await fetch(makeUrl(urlInburi));
                        if (!res.ok) throw new Error("Network response was not ok");
                        const json = await res.json();
                        
                        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô Proxy ‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß Data ‡∏≠‡∏≤‡∏à‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô)
                        const data = json.data || json.contents && JSON.parse(json.contents).data || json; 

                        if (Array.isArray(data)) {
                            const station = data.find(d => 
                                (d.station.tele_station_name.th && d.station.tele_station_name.th.includes("‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ")) || 
                                (d.geocode.tumbon_name.th && d.geocode.tumbon_name.th.includes("‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ"))
                            );

                            if (station) {
                                const wl = parseFloat(station.waterlevel_msl);
                                const diff = BANK_LEVEL - wl;
                                
                                document.getElementById('water-val').innerHTML = `${wl.toFixed(2)} <span class="card-unit">‡∏°.</span>`;
                                const wDesc = document.getElementById('water-desc');
                                wDesc.className = "card-sub";
                                
                                if(diff > 0) {
                                    wDesc.innerHTML = `‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏•‡∏¥‡πà‡∏á ${diff.toFixed(2)} ‡∏°. ‚úÖ`;
                                    wDesc.classList.add('st-good');
                                } else {
                                    wDesc.innerHTML = `‚ö†Ô∏è ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏•‡∏¥‡πà‡∏á ${Math.abs(diff).toFixed(2)} ‡∏°.`;
                                    wDesc.classList.add('st-danger');
                                }
                                inburiSuccess = true; // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏´‡∏¢‡∏∏‡∏î‡∏•‡∏≠‡∏á Proxy ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ
                            }
                        }
                    } catch (e) {
                        console.warn(`Proxy #${i+1} failed for Inburi:`, e);
                    }
                }

                // B. ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á ‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤
                if (!damSuccess) {
                    try {
                        const res = await fetch(makeUrl(urlDam));
                        if (!res.ok) throw new Error("Network err");
                        const json = await res.json();
                        const data = json.data || json.contents && JSON.parse(json.contents).data || json;

                        if (Array.isArray(data)) {
                            const dam = data.find(d => d.station.tele_station_oldcode === "C.13");
                            if (dam) {
                                const discharge = parseFloat(dam.discharge);
                                document.getElementById('dam-val').innerHTML = `${discharge.toLocaleString()} <span class="card-unit">‡∏•‡∏ö.‡∏°./‡∏ß‡∏¥</span>`;
                                
                                const dDesc = document.getElementById('dam-desc');
                                dDesc.className = "card-sub";
                                if(discharge > 2000) { 
                                    dDesc.innerText = "‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏™‡∏π‡∏á (‡∏ò‡∏á‡πÅ‡∏î‡∏á)"; 
                                    dDesc.classList.add('st-danger');
                                } else if(discharge > 800) { 
                                    dDesc.innerText = "‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á"; 
                                    dDesc.classList.add('st-warn');
                                } else { 
                                    dDesc.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏Å‡∏ï‡∏¥"; 
                                    dDesc.classList.add('st-good');
                                }
                                damSuccess = true;
                            }
                        }
                    } catch (e) {
                         console.warn(`Proxy #${i+1} failed for Dam:`, e);
                    }
                }

                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 ‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡πá‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏õ‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á Proxy ‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πà‡∏≠
                if (inburiSuccess && damSuccess) break;
            }

            // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏ô‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å Proxy ‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (!inburiSuccess) {
                document.getElementById('water-val').innerText = "N/A";
                document.getElementById('water-desc').innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏°‡∏ä‡∏•‡∏Ø ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
                document.getElementById('water-desc').classList.add('st-danger');
            }
            if (!damSuccess) {
                 document.getElementById('dam-val').innerText = "N/A";
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                document.getElementById('last-update').innerText = "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS...";
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        lat = position.coords.latitude;
                        lon = position.coords.longitude;
                        localStorage.setItem('userLat', lat);
                        localStorage.setItem('userLon', lon);
                        document.getElementById('location-badge').innerText = "üìç GPS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
                        fetchAllData();
                    },
                    (error) => {
                        alert("‡πÄ‡∏õ‡∏¥‡∏î GPS ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏´‡∏£‡∏∑‡∏≠ Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö");
                        fetchAllData();
                    }
                );
            } else {
                alert("Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS");
            }
        }

        function resetLocation() {
            localStorage.removeItem('userLat');
            localStorage.removeItem('userLon');
            lat = DEFAULT_LAT;
            lon = DEFAULT_LON;
            document.getElementById('location-badge').innerText = "üìç ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)";
            fetchAllData();
        }

    </script>
</body>
</html>
