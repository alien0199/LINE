<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Weather In Buri üå§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;600&display=swap" rel="stylesheet">
    <style>
/* ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏™‡∏î‡πÉ‡∏™ ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 15px;
            color: #444;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 35px;
            padding: 30px 20px;
            width: 100%;
            max-width: 380px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 2px solid #fff;
        }

        .location-badge {
            background: #ff9a9e;
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.85em;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4);
        }

        h1 { margin: 0; color: #555; font-size: 1.6em; font-weight: 600; }
        .timestamp { font-size: 0.8em; color: #888; margin-bottom: 25px; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        .data-box {
            background: #ffffff;
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s;
        }
        .data-box:active { transform: scale(0.98); }

        .weather-icon img { width: 80px; height: 80px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        
        .temp-big {
            display: inline-flex;
            align-items: baseline;
            gap: 6px;
            font-size: clamp(3.6rem, 12vw, 5.2rem);
            font-weight: 900;
            line-height: 1;
            letter-spacing: -0.02em;
            color: #2e93ff;
            padding: 10px 14px;
            border-radius: 18px;
            background: linear-gradient(90deg, rgba(31,162,255,0.14), rgba(18,216,250,0.10));
            box-shadow: 0 12px 26px rgba(31,162,255,0.14);
            text-shadow: 0 10px 18px rgba(46,147,255,0.20);
            font-variant-numeric: tabular-nums;
        }
        .weather-desc {
            font-size: 1.05em;
            font-weight: 650;
            color: #4b5563;
            margin-top: 10px;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏ù‡∏∏‡πà‡∏ô PM2.5 */
        .pm-label { font-size: 0.9em; color: #888; text-align: left; }
        .pm-value {
            display: inline-flex;
            align-items: baseline;
            justify-content: center;
            font-size: clamp(2.8rem, 10vw, 4.6rem);
            font-weight: 950;
            line-height: 1.05;
            letter-spacing: -0.02em;
            color: #111827;
            padding: 12px 16px;
            border-radius: 18px;
            background: rgba(0, 0, 0, 0.03);
            box-shadow: 0 12px 26px rgba(0,0,0,0.08);
            text-shadow: 0 10px 18px rgba(0,0,0,0.10);
            font-variant-numeric: tabular-nums;
        }
        .pm-unit {
            font-size: 0.38em;
            color: #6b7280;
            font-weight: 700;
            margin-left: 6px;
        }
        .pm-status {
            font-size: 1.05em;
            font-weight: 750;
            margin-top: 12px;
            letter-spacing: 0.01em;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ */
        .water-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }
        .water-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .water-value {
            display: inline-flex;
            align-items: baseline;
            justify-content: center;
            font-size: clamp(2.6rem, 8vw, 4rem);
            font-weight: 900;
            line-height: 1;
            color: #0a4e78;
            padding: 10px 14px;
            border-radius: 18px;
            background: rgba(10, 78, 120, 0.05);
            font-variant-numeric: tabular-nums;
        }
        .water-unit {
            font-size: 0.38em;
            color: #6b7280;
            font-weight: 700;
            margin-left: 6px;
        }
        .water-status {
            font-size: 1.05em;
            font-weight: 750;
            margin-top: 12px;
            letter-spacing: 0.01em;
        }
        .water-sub-info {
            font-size: 0.85em;
            color: #666;
            background: #f0f4f8;
            padding: 8px 12px;
            border-radius: 12px;
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
        .status-good { color: #00b894; }
        .status-moderate { color: #fdcb6e; }
        .status-bad { color: #ff7675; }
        .status-vbad { color: #d63031; }
        .water-normal { color: #00b894; }
        .water-high { color: #d32f2f; }

        /* ‡∏õ‡∏∏‡πà‡∏° Refresh */
        .btn-refresh {
            background: linear-gradient(45deg, #a18cd1, #fbc2eb);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 50px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 5px 20px rgba(161, 140, 209, 0.4);
            font-family: 'Kanit', sans-serif;
            font-weight: 500;
        }
        .btn-refresh:hover { opacity: 0.9; }

        .address, .coords { color: #888; margin-top: 6px; font-size: 0.8em; }
        .loc-actions { display: flex; gap: 10px; justify-content: center; margin: 12px 0 6px 0; }
        .btn-small { padding: 8px 15px; border-radius: 50px; font-size: 0.85em; border: none; cursor: pointer; }
        .btn-secondary { background: #43e97b; color: #fff; }
        .btn-ghost { background: #f1f2f6; color: #555; }
        .map-link { font-size: 0.85em; color: #6c5ce7; text-decoration: none; display: block; margin-top: 5px;}

    </style>
</head>
<body>

    <div class="card">
        <div class="location-badge" id="loc-badge">üìç ‡∏´‡∏°‡∏π‡πà 6 ‡∏ï.‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ</div>
        <h1>‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h1>
        <div class="address" id="loc-address">‡∏´‡∏°‡∏π‡πà 6 ‡∏ï‡∏≥‡∏ö‡∏•‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ 16110</div>
        <div class="coords" id="loc-coords">‡∏û‡∏¥‡∏Å‡∏±‡∏î: --</div>
        <div class="timestamp" id="last-update">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        
        <div class="loc-actions">
            <button class="btn-small btn-secondary" onclick="useGPS()">üì° ‡πÉ‡∏ä‡πâ GPS</button>
            <button class="btn-small btn-ghost" onclick="resetLocation()">‚Ü©Ô∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>
        <a class="map-link" id="map-link" href="#" target="_blank">üó∫Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>

        <!-- ‡∏≠‡∏≤‡∏Å‡∏≤‡∏® -->
        <div class="data-box">
            <div style="text-align: left;">
                <div class="temp-big" id="temp">--¬∞</div>
                <div class="weather-desc" id="weather-desc">‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</div>
                <div style="font-size: 0.8em; color:#aaa; margin-top:5px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <span id="humidity">--</span>%</div>
            </div>
            <div class="weather-icon" id="weather-icon"></div>
        </div>

        <!-- ‡∏ù‡∏∏‡πà‡∏ô -->
        <div class="data-box" style="display: block; text-align: center;">
            <div class="water-row" style="margin-bottom: 5px;">
                <span class="pm-label">‡∏ù‡∏∏‡πà‡∏ô PM 2.5</span>
                <span>üò∑</span>
            </div>
            <div class="pm-value" id="pm-val">-- <span class="pm-unit">Œºg/m¬≥</span></div>
            <div class="pm-status" id="pm-status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
        </div>

        <!-- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ + ‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤ -->
        <div class="data-box" style="display: block; text-align: center;">
            <div class="water-row" style="margin-bottom: 10px;">
                <span class="pm-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ</span>
                <span>üåä</span>
            </div>
            
            <!-- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ -->
            <div class="water-value" id="water-val">-- <span class="water-unit">‡∏°.</span></div>
            <div class="water-status" id="water-status">‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            <div id="water-diff" style="font-size: 0.85em; color:#555; margin-top:5px;"></div>

            <!-- ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏° python) -->
            <div class="water-sub-info">
                <span>‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤‡∏õ‡∏•‡πà‡∏≠‡∏¢:</span>
                <span style="font-weight: 600; color:#0a4e78;" id="dam-val">-- ‡∏•‡∏ö.‡∏°./‡∏ß‡∏¥</span>
            </div>
        </div>

        <button class="btn-refresh" onclick="fetchData()">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
    </div>

    <script>
        // --- Configuration ---
        const DEFAULT_LAT = 15.01214775378357;
        const DEFAULT_LON = 100.33122177175338;
        const DEFAULT_LABEL = '‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ';
        const BANK_LEVEL = 13.0; // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏•‡∏¥‡πà‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ

        let LAT = DEFAULT_LAT;
        let LON = DEFAULT_LON;
        const PROXY_URL = 'https://corsproxy.io/?'; 

        // --- Weather Codes ---
        const WEATHER_CODE_TH = {
            0: "‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á", 1: "‡∏°‡∏µ‡πÄ‡∏°‡∏Ü‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢", 2: "‡∏°‡∏µ‡πÄ‡∏°‡∏Ü‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô", 3: "‡πÄ‡∏°‡∏Ü‡∏°‡∏≤‡∏Å",
            45: "‡∏´‡∏°‡∏≠‡∏Å", 51: "‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡∏ù‡∏ô‡πÄ‡∏ö‡∏≤", 53: "‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡∏ù‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á", 55: "‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡∏ù‡∏ô‡∏´‡∏ô‡∏±‡∏Å",
            61: "‡∏ù‡∏ô‡πÄ‡∏ö‡∏≤", 63: "‡∏ù‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á", 65: "‡∏ù‡∏ô‡∏´‡∏ô‡∏±‡∏Å", 80: "‡∏ù‡∏ô‡πÇ‡∏õ‡∏£‡∏¢‡πÄ‡∏ö‡∏≤", 
            81: "‡∏ù‡∏ô‡πÇ‡∏õ‡∏£‡∏¢‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á", 82: "‡∏ù‡∏ô‡πÇ‡∏õ‡∏£‡∏¢‡∏´‡∏ô‡∏±‡∏Å", 95: "‡∏û‡∏≤‡∏¢‡∏∏‡∏ù‡∏ô‡∏ü‡πâ‡∏≤‡∏Ñ‡∏∞‡∏ô‡∏≠‡∏á"
        };

        // --- UI Functions ---
        function updateLocationUI(extra = '') {
            document.getElementById('loc-coords').innerText = `‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${LAT.toFixed(4)}, ${LON.toFixed(4)}${extra ? ' ‚Ä¢ ' + extra : ''}`;
            document.getElementById('map-link').href = `https://www.google.com/maps?q=${LAT},${LON}`;
        }

        function setLocation(lat, lon, txt) {
            LAT = lat; LON = lon;
            localStorage.setItem('cLat', lat); localStorage.setItem('cLon', lon);
            updateLocationUI(txt);
        }
        
        function resetLocation() {
            localStorage.removeItem('cLat'); localStorage.removeItem('cLon');
            LAT = DEFAULT_LAT; LON = DEFAULT_LON;
            updateLocationUI(DEFAULT_LABEL);
            fetchData();
        }

        function useGPS() {
            if(!navigator.geolocation) return alert('‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS');
            document.getElementById('last-update').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î...';
            navigator.geolocation.getCurrentPosition(pos => {
                setLocation(pos.coords.latitude, pos.coords.longitude, 'GPS');
                fetchData();
            }, () => alert('‡πÄ‡∏õ‡∏¥‡∏î GPS ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'), {timeout:10000});
        }

        // --- Fetch Helper ---
        async function fetchJson(url) {
            try {
                // ‡πÉ‡∏ä‡πâ Proxy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏∞‡∏•‡∏∏ CORS
                const res = await fetch(PROXY_URL + encodeURIComponent(url));
                if (!res.ok) throw new Error('Network Err');
                return await res.json();
            } catch (e) { console.error(e); return null; }
        }

        // --- Core Logic ---
        async function fetchData() {
            const now = new Date();
            document.getElementById('last-update').innerText = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ${now.toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'})} ‡∏ô.`;

            // 1. Weather (OpenMeteo)
            const wData = await fetchJson(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,relative_humidity_2m,weather_code&timezone=Asia%2FBangkok`);
            if (wData && wData.current) {
                document.getElementById('temp').innerText = Math.round(wData.current.temperature_2m) + "¬∞";
                document.getElementById('humidity').innerText = Math.round(wData.current.relative_humidity_2m) + "%";
                const code = wData.current.weather_code;
                document.getElementById('weather-desc').innerText = WEATHER_CODE_TH[code] || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            }

            // 2. Air Quality (OpenMeteo)
            const aData = await fetchJson(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${LAT}&longitude=${LON}&current=pm2_5&timezone=Asia%2FBangkok`);
            if (aData && aData.current) {
                const pm = Math.round(aData.current.pm2_5);
                document.getElementById('pm-val').innerHTML = `${pm} <span class="pm-unit">Œºg/m¬≥</span>`;
                const sEl = document.getElementById('pm-status');
                sEl.className = 'pm-status';
                if(pm <= 25) { sEl.innerText = "‡∏î‡∏µ/‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á"; sEl.classList.add('status-good'); }
                else if(pm <= 50) { sEl.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û"; sEl.classList.add('status-moderate'); }
                else { sEl.innerText = "‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢"; sEl.classList.add('status-vbad'); }
            }

            // 3. Water Level (ThaiWater API v3 - Logic from main.py)
            await fetchWaterData();
        }

        async function fetchWaterData() {
            const statusEl = document.getElementById('water-status');
            const valEl = document.getElementById('water-val');
            const diffEl = document.getElementById('water-diff');
            const damEl = document.getElementById('dam-val');
            
            statusEl.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

            try {
                // 3.1 ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ (‡∏à.‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ Code=17)
                // ‡∏ï‡∏≤‡∏° python: api-v3.thaiwater.net/api/v1/thaiwater30/public/waterlevel?province_code=17
                const sbData = await fetchJson('https://api-v3.thaiwater.net/api/v1/thaiwater30/public/waterlevel?province_code=17');
                
                let foundLevel = null;
                if (sbData && sbData.data) {
                    // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏´‡∏≤‡∏ï‡∏≤‡∏° logic python: tumbon="‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ" ‡πÅ‡∏•‡∏∞ station="‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ"
                    const station = sbData.data.find(item => {
                        const tb = item.geocode?.tumbon_name?.th || "";
                        const st = item.station?.tele_station_name?.th || "";
                        return tb.includes("‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ") && st.includes("‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ");
                    });

                    if (station) {
                        foundLevel = parseFloat(station.waterlevel_msl);
                    }
                }

                if (foundLevel !== null && !isNaN(foundLevel)) {
                    valEl.innerHTML = `${foundLevel.toFixed(2)} <span class="water-unit">‡∏°.</span>`;
                    const diff = BANK_LEVEL - foundLevel;
                    
                    if (diff > 0) {
                        statusEl.innerText = "‡∏ô‡πâ‡∏≥‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)";
                        statusEl.classList.add('water-normal');
                        diffEl.innerText = `‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏•‡∏¥‡πà‡∏á ${diff.toFixed(2)} ‡∏°.`;
                    } else {
                        statusEl.innerText = "‡∏ô‡πâ‡∏≥‡∏•‡πâ‡∏ô‡∏ï‡∏•‡∏¥‡πà‡∏á!";
                        statusEl.classList.add('water-high');
                        diffEl.innerText = `‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏•‡∏¥‡πà‡∏á ${Math.abs(diff).toFixed(2)} ‡∏°.`;
                    }
                } else {
                    valEl.innerHTML = `-- <span class="water-unit">‡∏°.</span>`;
                    statusEl.innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ";
                    diffEl.innerText = "";
                }

                // 3.2 ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤ (‡∏à.‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó Code=18, C.13)
                // ‡∏ï‡∏≤‡∏° python: province_code=18 -> tele_station_oldcode="C.13"
                const cnData = await fetchJson('https://api-v3.thaiwater.net/api/v1/thaiwater30/public/waterlevel?province_code=18');
                let foundDischarge = null;

                if (cnData && cnData.data) {
                    const dam = cnData.data.find(item => item.station?.tele_station_oldcode === "C.13");
                    if (dam) {
                        foundDischarge = parseFloat(dam.discharge);
                    }
                }

                if (foundDischarge !== null && !isNaN(foundDischarge)) {
                    damEl.innerText = `${foundDischarge.toLocaleString()} ‡∏•‡∏ö.‡∏°./‡∏ß‡∏¥`;
                } else {
                    damEl.innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                }

            } catch (err) {
                console.error(err);
                statusEl.innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß";
            }
        }

        // Init
        const sLat = localStorage.getItem('cLat');
        const sLon = localStorage.getItem('cLon');
        if(sLat) { LAT = parseFloat(sLat); LON = parseFloat(sLon); updateLocationUI('Saved'); }
        
        fetchData();
    </script>
</body>
</html>
